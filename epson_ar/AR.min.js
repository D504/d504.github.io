b4w.register("AR_main",function(aa,e){function ba(b,a){a?(N.create_preloader(),b.oncontextmenu=function(a){a.preventDefault();a.stopPropagation();return!1},ca.load(D+"AR.json",da,ea)):console.log("b4w init failure")}function ea(b){N.update_preloader(b)}function da(b,a){navigator.mediaDevices?navigator.mediaDevices.enumerateDevices().then(O)["catch"](E):E(Error("WebRTC: It seems WebRTC is not supported on your device."));var c=y.get_container();c.addEventListener("click",function(){P.request_fullscreen(c)});
document.getElementById("switch_video").addEventListener("click",function(){var a=!0,b=document.getElementById("v");return function fa(){a=!a;b.style.display=a?"":"none";F(a?1:1/3);a||P.request_fullscreen(c,function(){},fa)}}());document.querySelector(".control").style.display=G.is_ie11()?"block":"grid";if(a){Q.enable_camera_controls();ga();k={front:g.get_object_by_name("orbits_front"),back:g.get_object_by_name("orbits_back"),start_scale:1,start_time:-Infinity};ha();var e=n.create_mouse_click_sensor(),
f=n.create_touch_click_sensor(),l=n.create_timeline_sensor();n.create_sensor_manifold(null,"TRIG_ANIMATION",n.CT_SHOT,[e,f,l],function(a){return a[0]||a[1]},function(a,b,c){var d=n.get_sensor_value(a,b,0),z=n.get_sensor_value(a,b,1);c=n.get_sensor_value(a,b,2);if(d||z)if(a=d?n.get_sensor_payload(a,b,0):n.get_sensor_payload(a,b,1),a=y.client_to_canvas_coords(a.coords[0],a.coords[1],ia),a=g.pick_object(a[0],a[1])){a:{for(b=0;b<q.length;b++)if(d=q[b],d.geom===a){b=d;break a}b=null}if(b)for(u=b.focused?
!1:!0,p.start_time=c,b=h.get_translation_rel(p.geom,r),p.start_trans_length=m.length(b),k.start_time=c,k.start_scale=h.get_scale(k.front),b=0;b<q.length;b++)d=q[b],z=h.get_translation_rel(d.armature,r),u?(m.copy(z,d.original_trans),d.focused=d.geom==a?!0:!1):d.focused=!1,d.start_scale=h.get_scale(d.armature),d.start_time=c,d.start_trans_length=m.length(z)}});l=n.create_timeline_sensor();n.create_sensor_manifold(null,"ANIMATION",n.CT_POSITIVE,[l],null,function(a,b,d){a=n.get_sensor_value(a,b,0);d=
a-p.start_time;1>=d&&(b=m.copy(G.AXIS_X,r),d=u?t.ease_out_expo(d,p.start_trans_length,50,1):t.ease_out_expo(d,p.start_trans_length,-p.start_trans_length,1),b=m.scale(b,d,r),b=m.add(b,p.origin_trans,b),h.set_translation_rel_v(p.geom,b),h.set_translation_rel_v(p.crown_geom,b),h.set_translation_rel_v(p.lamp,b));u&&(H=!1);for(b=0;b<q.length;b++){d=q[b];var c=a-d.start_time;if(1>=c){var e,f;if(u)d.focused?(e=t.ease_out_bounce(c,d.start_scale,20/(ja[d.name]*I[d.name]),1),c=t.ease_out_expo(c,d.start_trans_length,
-d.start_trans_length,1)):(e=t.ease_in_circ(c,d.start_scale,-d.start_scale,1),c=t.ease_in_expo(c,d.start_trans_length,500,1)),f=m.normalize(d.original_trans,r),f=m.scale(f,c,r),R.stop(d.empty);else{e=t.ease_out_expo(c,d.start_scale,I[d.name]-d.start_scale,1);f=m.normalize(d.original_trans,r);var l=m.length(d.original_trans),c=t.ease_out_expo(c,d.start_trans_length,l-d.start_trans_length,1);f=m.scale(f,c,r)}h.set_translation_rel_v(d.armature,f);h.set_scale(d.armature,e)}else if(u)for(b=0;b<q.length;b++)d=
q[b],d.focused||h.set_scale(d.armature,0);else if(!H)for(b=0;b<q.length;b++)d=q[b],h.set_translation_rel_v(d.armature,d.original_trans),R.play(d.empty),H=!0}a-=k.start_time;1>=a?(u?a=t.ease_in_expo(a,k.start_scale,50,1):(g.is_hidden(k.front)&&(g.show_object(k.front),g.show_object(k.back)),a=t.ease_out_expo(a,k.start_scale,1-k.start_scale,1)),h.set_scale(k.front,a),h.set_scale(k.back,a)):u?g.is_hidden(k.front)||(g.hide_object(k.front),g.hide_object(k.back)):(h.set_scale(k.front,1),h.set_scale(k.back,
1))})}else console.log("b4w load failure")}function ha(){var b=g.get_object_by_name("Sun_geom");p={geom:g.get_object_by_name("Sun_geom"),crown_geom:g.get_object_by_name("Sun_crown_geom"),lamp:g.get_object_by_name("Lamp"),start_time:-Infinity,start_trans_length:0,origin_trans:h.get_translation_rel(b,new Float32Array(3))}}function ga(){for(var b=0;b<S.length;b++){var a;a=S[b];a={name:a,empty:g.get_object_by_name(a+"_Emty"),geom:g.get_object_by_name(a+"_geom"),empty_action:a+"_EmtyAction",geom_action:a+
"_ArmatureAction",armature:g.get_object_by_name(a+"_Armature"),focused:!1,start_time:-Infinity,start_scale:1,original_trans:new Float32Array(3),start_trans_length:1};h.set_scale(a.armature,I[a.name]);q.push(a)}}function O(b){for(var a=document.querySelector("select#video_source");a.firstChild;)a.removeChild(a.firstChild);if(!b.length)throw Error("Camera devices are unavailable. Try to plug in your Web camera. If the camera is actually present, try closing any other tabs which use the camera, and reboot the current tab.");
for(var c=0;c!==b.length;++c){var e=b[c];if("videoinput"===e.kind){var f=document.createElement("option");f.value=e.deviceId;f.text=e.label||"Camera "+(a.length+1);a.appendChild(f)}}J.set_render_callback(ka)}function E(b){var a=g.get_active_camera();T.target_setup(a,{pos:la,pivot:U,use_panning:!0});window.removeEventListener("resize",K);window.addEventListener("resize",V);V();a=g.get_object_by_name("Empty");g.show_object(a);h.set_translation_v(a,U);J.clear_render_callback();if(a=document.getElementById("error"))a.style.display=
G.is_ie11()?"block":"grid","DevicesNotFoundError"==b.name?a.textContent="Camera devices are unavailable. Try to plug in your Web camera. If the camera is actually present, try closing any other tabs which use the camera, and reboot the current tab.":"TrackStartError"==b.name?(a.textContent="Media devices are unavailable.",a.textContent+=" Try to close another program using Web camera."):a.textContent="Error: "+b.name+" "+b.message}function ma(b){window.stream=b;A.srcObject=b;return navigator.mediaDevices.enumerateDevices()}
function W(){window.stream&&window.stream.getTracks().forEach(function(a){a.stop()});var b=document.querySelector("select#video_source");b.onchange=W;b=b.value;navigator.mediaDevices.getUserMedia({video:{deviceId:b?{exact:b}:void 0}}).then(ma).then(O).then(F)["catch"](E)}function ka(){F();window.addEventListener("resize",K);A||(A=document.getElementById("v"),W());var b=g.get_object_by_name("Empty");l.detectMarker(A);if(0<l.getMarkerNum())if(-Infinity===B)B=performance.now();else{if(100<performance.now()-
B){L?(l.getTransMatSquareCont(0,1,w,w),g.is_hidden(b)&&g.show_object(b)):l.getTransMatSquare(0,1,w);l.getTransMatSquare(0,1,w);var a=l.transMatToGLMat(w,x);if(J.detect_mobile()&&-1<navigator.userAgent.indexOf("Firefox")){var c=x;c[0]=a[0];c[1]=-a[1];c[2]=a[2];c[3]=a[3];c[4]=-a[4];c[5]=a[5];c[6]=-a[6];c[7]=-a[7];c[8]=a[8];c[9]=-a[9];c[10]=a[10];c[11]=a[11];c[12]=a[12];c[13]=-a[13];c[14]=a[14];c[15]=a[15];a=c}c=v.fromXRotation(-Math.PI,na);a=v.multiply(c,a,x);a=C.from_mat4(a,oa);c=C.get_trans_view(a,
r);c=m.scale(c,20,r);C.set_trans(c,a);h.set_tsr(b,a);L=!0}}else g.hide_object(b),L=!1,B=-Infinity}function F(b){if(l&&(K(),!X||b)){Y=l.getCameraMatrix();var a=g.get_active_camera(),c=v.fromXRotation(-Math.PI,x),c=v.multiply(Y,c,x),e=v.invert(c,new Float32Array(16)),c=m.transformMat4([-1,-1,-1],e,[]),f=m.transformMat4([1,1,-1],e,[]),e=m.transformMat4([1,1,1],e,[]);b=b||1;b=v.frustum(c[0]*b,f[0]*b,c[1]*b,f[1]*b,-c[2],-e[2],[]);T.set_projection(a,b);X=!0}}function V(){y.resize_to_container(!0)}function K(){var b=
document.getElementById("v"),a=y.get_canvas();if(b&&a){var c=window.innerWidth,e=window.innerHeight,f=b.videoWidth/b.videoHeight;c/e<f?(f*=e,a.style.width=f+"px",a.style.marginLeft=-(f-c)/2+"px",a.style.height=e+"px",a.style.marginTop="0px"):(f=1/(f/c),a.style.height=f+"px",a.style.marginTop=-(f-e)/2+"px",a.style.width=c+"px",a.style.marginLeft="0px");b.style.width=a.style.width;b.style.height=a.style.height;b.style.marginLeft=a.style.marginLeft;b.style.marginTop=a.style.marginTop}}var R=e("animation"),
Q=e("app"),T=e("camera"),pa=e("config"),y=e("container"),n=e("controls"),ca=e("data"),J=e("main"),v=e("mat4"),t=e("math"),N=e("preloader"),C=e("tsr"),g=e("scenes"),P=e("screen"),h=e("transform"),G=e("util"),qa=e("version"),m=e("vec3");e("vec4");var oa=C.create(),ia=new Float32Array(2),r=m.create(),w=new Float64Array(12),x=new Float32Array(16),na=new Float32Array(16),U=new Float32Array([0,0,0]),la=new Float32Array([30,30,30]),Z="DEBUG"==qa.type(),D=pa.get_std_assets_path()+"AR/",l=null,A=null,L=!1,
B=-Infinity,X=!1,S="Earth Jupiter Mars Mercury Neptune Saturn Uranus Venus".split(" "),ja={Mercury:.964,Venus:1.845,Earth:2,Mars:1.374,Jupiter:8.439,Saturn:5.539,Uranus:3.986,Neptune:3.995},I={Mercury:2,Venus:1.5,Earth:1.5,Mars:1.7,Jupiter:1,Saturn:1,Uranus:1,Neptune:1},q=[],u=!1,p=null,k=null,H=!0;aa.init=function(){Q.init({canvas_container_id:"main_canvas_container",callback:ba,show_fps:Z,console_verbose:Z,autoresize:!1})};var M=new ARCameraParam,Y=null;M.onload=function(){l=new ARController(320,
240,M);l.setThreshold(100);l.setPatternDetectionMode(artoolkit.AR_MARKER_INFO_CUTOFF_PHASE_POSE_ERROR_MULTI);l.loadMarker(D+"solar.patt")};M.load(D+"camera_para.dat")});b4w.require("AR_main").init();
